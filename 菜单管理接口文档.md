# 菜单管理接口文档

**基础URL**: `http://127.0.0.1:8080/api`

## 接口概述

菜单管理模块提供菜单的增删改查功能，支持分页查询和树形结构查询。菜单系统支持三种节点类型：文件夹、页面和按钮，用于构建系统的导航结构和权限控制。

## 通用响应格式

所有接口都返回统一的JSON格式：

```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| success | Boolean | 请求是否成功 |
| code | Integer | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 响应数据 |

## 菜单数据模型

### Menu 对象结构

```json
{
  "id": 1,
  "parentId": null,
  "menuCode": "system",
  "name": "系统管理",
  "module": "system",
  "nodeType": 1,
  "nodeTypeText": "文件夹",
  "sortOrder": 1,
  "url": "/system",
  "createdAt": "2025-09-11T17:04:08"
}
```

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 菜单ID |
| parentId | Long | 父级菜单ID，根菜单为null |
| menuCode | String | 菜单编码，系统内唯一标识 |
| name | String | 菜单名称 |
| module | String | 业务模块标识 |
| nodeType | Integer | 节点类型：1=文件夹，2=页面，3=按钮 |
| nodeTypeText | String | 节点类型描述 |
| sortOrder | Integer | 排序序号，数字越小越靠前 |
| url | String | URL路径，可选字段 |
| createdAt | DateTime | 创建时间 |

### 节点类型说明

| 类型值 | 类型名称 | 说明 |
|--------|----------|------|
| 1 | 文件夹 | 用于分组，通常不对应具体页面 |
| 2 | 页面 | 对应系统中的具体页面或功能模块 |
| 3 | 按钮 | 页面内的操作按钮或功能点 |

## 接口列表

### 1. 分页查询菜单列表

**接口地址**: `GET /permissions/menus/list`

**权限要求**: `menu:menu:view`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**查询参数**:

| 参数 | 类型 | 必填 | 默认值 | 说明 |
|------|------|------|--------|------|
| name | String | 否 | - | 菜单名称模糊查询 |
| menuCode | String | 否 | - | 菜单编码模糊查询 |
| module | String | 否 | - | 业务模块标识 |
| nodeType | Integer | 否 | - | 节点类型筛选 |
| parentId | Long | 否 | - | 父级菜单ID |
| page | Integer | 否 | 1 | 页码，从1开始 |
| size | Integer | 否 | 10 | 每页大小 |

**请求示例**:
```
GET /permissions/menus/list?name=用户&nodeType=2&page=1&size=10
```

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 2,
        "parentId": 1,
        "menuCode": "user",
        "name": "用户管理",
        "module": "menu",
        "nodeType": 2,
        "nodeTypeText": "页面",
        "sortOrder": 1,
        "createdAt": "2025-09-11T17:18:57"
      },
      {
        "id": 3,
        "parentId": 1,
        "menuCode": "role",
        "name": "角色管理",
        "module": "menu",
        "nodeType": 2,
        "nodeTypeText": "页面",
        "sortOrder": 2,
        "createdAt": "2025-09-11T17:19:51"
      }
    ],
    "total": 2,
    "page": 1,
    "size": 10,
    "totalPages": 1,
    "hasNext": false,
    "hasPrevious": false
  }
}
```

**分页响应字段说明**:

| 字段 | 类型 | 说明 |
|------|------|------|
| list | Array | 菜单数据列表 |
| total | Long | 总记录数 |
| page | Integer | 当前页码 |
| size | Integer | 每页大小 |
| totalPages | Integer | 总页数 |
| hasNext | Boolean | 是否有下一页 |
| hasPrevious | Boolean | 是否有上一页 |

---

### 2. 获取菜单树结构

**接口地址**: `GET /permissions/menus/tree`

**权限要求**: `menu:menu:view`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**请求参数**: 无

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "parentId": null,
      "menuCode": "system",
      "name": "系统管理",
      "module": "menu",
      "nodeType": 1,
      "sortOrder": 1,
      "createdAt": "2025-09-11T17:04:08"
    },
    {
      "id": 2,
      "parentId": 1,
      "menuCode": "user",
      "name": "用户管理",
      "module": "menu",
      "nodeType": 2,
      "sortOrder": 1,
      "createdAt": "2025-09-11T17:18:57"
    }
  ]
}
```

**使用场景**:
- 构建系统导航菜单
- 菜单权限分配时的树形选择
- 系统架构展示

---

### 3. 创建菜单

**接口地址**: `POST /permissions/menus/create`

**权限要求**: `menu:menu:add`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

**请求参数**:
```json
{
  "parentId": 1,
  "menuCode": "product",
  "name": "商品管理",
  "module": "product",
  "nodeType": 2,
  "sortOrder": 3,
  "url": "/product"
}
```

**参数说明**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| parentId | Long | 否 | 父级菜单ID，根菜单可为null |
| menuCode | String | 是 | 菜单编码，系统内唯一 |
| name | String | 是 | 菜单名称 |
| module | String | 是 | 业务模块标识 |
| nodeType | Integer | 否 | 节点类型，默认为2（页面） |
| sortOrder | Integer | 否 | 排序序号，默认为0 |
| url | String | 否 | URL路径 |

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "菜单创建成功",
  "data": null
}
```

---

### 4. 更新菜单

**接口地址**: `PUT /permissions/menus/update`

**权限要求**: `menu:menu:edit`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

**请求参数**:
```json
{
  "id": 1,
  "parentId": null,
  "menuCode": "system",
  "name": "系统管理中心",
  "module": "system",
  "nodeType": 1,
  "sortOrder": 1,
  "url": "/system"
}
```

**参数说明**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 菜单ID |
| parentId | Long | 否 | 父级菜单ID |
| menuCode | String | 是 | 菜单编码 |
| name | String | 是 | 菜单名称 |
| module | String | 是 | 业务模块标识 |
| nodeType | Integer | 是 | 节点类型 |
| sortOrder | Integer | 是 | 排序序号 |
| url | String | 否 | URL路径 |

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "菜单更新成功",
  "data": null
}
```

---

### 5. 删除菜单

**接口地址**: `DELETE /permissions/menus/delete/{id}`

**权限要求**: `menu:menu:delete`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 菜单ID |

**请求示例**:
```
DELETE /permissions/menus/delete/1
```

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "菜单删除成功",
  "data": null
}
```

**注意事项**:
- 删除菜单会级联删除其所有子菜单
- 删除操作会清理相关的权限缓存
- 建议在删除前确认菜单下是否有重要的子菜单或权限配置

---

## 错误码说明

| HTTP状态码 | 响应码 | 说明 | 示例场景 |
|-----------|--------|------|----------|
| 200 | 200 | 请求成功 | 正常的API调用 |
| 400 | 400 | 请求参数错误 | 缺少必填参数、参数格式错误 |
| 401 | 401 | 未认证 | JWT Token无效或过期 |
| 403 | 500 | 权限不足 | 用户没有相应的操作权限 |
| 404 | 404 | 资源不存在 | 菜单ID不存在 |
| 500 | 500 | 服务器内部错误 | 数据库连接失败、系统异常 |

### 常见错误响应示例

**参数错误** (HTTP 400):
```json
{
  "success": false,
  "code": 400,
  "message": "菜单编码不能为空",
  "data": null
}
```

**菜单编码重复** (HTTP 400):
```json
{
  "success": false,
  "code": 400,
  "message": "菜单编码已存在：user",
  "data": null
}
```

**权限不足** (HTTP 403):
```json
{
  "success": false,
  "code": 500,
  "message": "权限不足，无法执行此操作",
  "data": null
}
```

**菜单不存在** (HTTP 404):
```json
{
  "success": false,
  "code": 404,
  "message": "菜单不存在",
  "data": null
}
```

## 权限说明

菜单管理接口需要以下权限：

| 权限码 | 说明 |
|--------|------|
| menu:menu:view | 查看菜单信息 |
| menu:menu:add | 创建菜单 |
| menu:menu:edit | 编辑菜单 |
| menu:menu:delete | 删除菜单 |

## 业务规则

### 菜单编码规范

1. **唯一性**: 菜单编码在系统中必须唯一
2. **命名规范**: 建议使用英文小写字母和下划线，如：user、role、user_profile
3. **层级关系**: 子菜单编码可以包含父菜单信息，如：user_list、user_add

### 节点类型说明

1. **文件夹 (nodeType=1)**:
   - 用于组织菜单结构
   - 通常不对应具体页面
   - 可以包含子菜单

2. **页面 (nodeType=2)**:
   - 对应系统中的具体页面
   - 是权限控制的主要单元
   - 可以包含按钮类型的子菜单

3. **按钮 (nodeType=3)**:
   - 对应页面中的具体操作按钮
   - 最细粒度的权限控制
   - 通常不包含子菜单

### 排序规则

- 按 `sortOrder` 字段升序排列
- 相同 `sortOrder` 时按 `id` 升序排列
- 建议为不同层级的菜单设置不同的排序区间

## 使用示例

### 完整的菜单管理流程

```bash
# 1. 分页查询菜单列表
curl -X GET "http://127.0.0.1:8080/api/permissions/menus/list?page=1&size=10" \
  -H "Authorization: Bearer {your_token}"

# 2. 按条件查询菜单
curl -X GET "http://127.0.0.1:8080/api/permissions/menus/list?name=用户&nodeType=2" \
  -H "Authorization: Bearer {your_token}"

# 3. 获取菜单树结构
curl -X GET "http://127.0.0.1:8080/api/permissions/menus/tree" \
  -H "Authorization: Bearer {your_token}"

# 4. 创建新菜单
curl -X POST "http://127.0.0.1:8080/api/permissions/menus/create" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {your_token}" \
  -d '{
    "parentId": 1,
    "menuCode": "permission",
    "name": "权限管理",
    "module": "menu",
    "nodeType": 2,
    "sortOrder": 4
  }'

# 5. 更新菜单信息
curl -X PUT "http://127.0.0.1:8080/api/permissions/menus/update" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {your_token}" \
  -d '{
    "id": 4,
    "parentId": 1,
    "menuCode": "permission",
    "name": "权限管理",
    "module": "menu",
    "nodeType": 2,
    "sortOrder": 3
  }'

# 6. 删除菜单
curl -X DELETE "http://127.0.0.1:8080/api/permissions/menus/delete/4" \
  -H "Authorization: Bearer {your_token}"
```

### JavaScript 示例

```javascript
// 基础配置
const API_BASE = 'http://127.0.0.1:8080/api';

// 获取JWT Token
function getToken() {
  return localStorage.getItem('jwt_token') || 'your_jwt_token_here';
}

// 通用请求函数
async function apiRequest(url, options = {}) {
  const response = await fetch(`${API_BASE}${url}`, {
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${getToken()}`,
      ...options.headers
    },
    ...options
  });
  return response.json();
}

// 分页查询菜单列表
async function getMenuList(params = {}) {
  const queryString = new URLSearchParams(params).toString();
  const url = `/permissions/menus/list${queryString ? '?' + queryString : ''}`;
  return await apiRequest(url);
}

// 获取菜单树
async function getMenuTree() {
  return await apiRequest('/permissions/menus/tree');
}

// 创建菜单
async function createMenu(menuData) {
  return await apiRequest('/permissions/menus/create', {
    method: 'POST',
    body: JSON.stringify(menuData)
  });
}

// 更新菜单
async function updateMenu(menuData) {
  return await apiRequest('/permissions/menus/update', {
    method: 'PUT',
    body: JSON.stringify(menuData)
  });
}

// 删除菜单
async function deleteMenu(menuId) {
  return await apiRequest(`/permissions/menus/delete/${menuId}`, {
    method: 'DELETE'
  });
}

// 使用示例
async function example() {
  try {
    // 查询菜单列表
    const menuList = await getMenuList({
      name: '用户',
      nodeType: 2,
      page: 1,
      size: 10
    });
    console.log('菜单列表:', menuList);

    // 获取菜单树
    const menuTree = await getMenuTree();
    console.log('菜单树:', menuTree);

    // 创建菜单
    const createResult = await createMenu({
      parentId: 1,
      menuCode: 'permission',
      name: '权限管理',
      module: 'menu',
      nodeType: 2,
      sortOrder: 4
    });
    console.log('创建结果:', createResult);

  } catch (error) {
    console.error('操作失败:', error);
  }
}

// 菜单管理组件示例
class MenuManager {
  constructor() {
    this.menus = [];
    this.currentPage = 1;
    this.pageSize = 10;
    this.total = 0;
  }

  // 加载菜单列表
  async loadMenus(filters = {}) {
    try {
      const params = {
        page: this.currentPage,
        size: this.pageSize,
        ...filters
      };

      const result = await getMenuList(params);
      if (result.success) {
        this.menus = result.data.list;
        this.total = result.data.total;
        this.renderMenuTable();
        this.renderPagination();
      } else {
        console.error('加载菜单失败:', result.message);
      }
    } catch (error) {
      console.error('加载菜单异常:', error);
    }
  }

  // 渲染菜单表格
  renderMenuTable() {
    const tbody = document.querySelector('#menu-table tbody');
    tbody.innerHTML = '';

    this.menus.forEach(menu => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${menu.id}</td>
        <td>${menu.name}</td>
        <td>${menu.menuCode}</td>
        <td>${menu.module}</td>
        <td>${menu.nodeTypeText}</td>
        <td>${menu.sortOrder}</td>
        <td>${menu.createdAt}</td>
        <td>
          <button onclick="menuManager.editMenu(${menu.id})">编辑</button>
          <button onclick="menuManager.deleteMenu(${menu.id})">删除</button>
        </td>
      `;
      tbody.appendChild(row);
    });
  }

  // 渲染分页
  renderPagination() {
    const totalPages = Math.ceil(this.total / this.pageSize);
    const pagination = document.getElementById('pagination');

    let html = '';
    for (let i = 1; i <= totalPages; i++) {
      const active = i === this.currentPage ? 'active' : '';
      html += `<button class="${active}" onclick="menuManager.goToPage(${i})">${i}</button>`;
    }

    pagination.innerHTML = html;
  }

  // 跳转页面
  async goToPage(page) {
    this.currentPage = page;
    await this.loadMenus();
  }

  // 编辑菜单
  async editMenu(menuId) {
    // 实现编辑逻辑
    console.log('编辑菜单:', menuId);
  }

  // 删除菜单
  async removeMenu(menuId) {
    if (confirm('确定要删除这个菜单吗？')) {
      try {
        const result = await deleteMenu(menuId);
        if (result.success) {
          alert('菜单删除成功！');
          await this.loadMenus(); // 重新加载列表
        } else {
          alert('删除菜单失败：' + result.message);
        }
      } catch (error) {
        console.error('删除菜单异常:', error);
        alert('删除菜单失败，请重试');
      }
    }
  }
}

// 初始化菜单管理器
const menuManager = new MenuManager();

// 页面加载时初始化
document.addEventListener('DOMContentLoaded', () => {
  menuManager.loadMenus();
});
```

---
