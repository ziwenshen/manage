# 权限接口文档

**基础URL**: `http://127.0.0.1:8080/api`

## 接口概述

权限管理模块提供权限的增删改查功能，以及菜单权限树查询功能。权限是系统中最细粒度的访问控制单元，用于控制用户对特定功能的访问权限。

## 通用响应格式

所有接口都返回统一的JSON格式：

```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| success | Boolean | 请求是否成功 |
| code | Integer | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 响应数据 |

## 权限数据模型

### Permission 对象结构

```json
{
  "id": 1,
  "code": "menu:user:view",
  "name": "查看用户",
  "module": "user",
  "menuCode": "user",
  "action": "view",
  "createdAt": "2025-09-08T09:36:06"
}
```

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 权限ID |
| code | String | 权限标识码，格式：module:menuCode:action |
| name | String | 权限名称（中文描述） |
| module | String | 业务模块标识 |
| menuCode | String | 菜单编码 |
| action | String | 操作类型（view、add、edit、delete等） |
| createdAt | DateTime | 创建时间 |

## 接口列表

### 1. 获取权限列表

**接口地址**: `GET /permissions/perm/list`

**权限要求**: `menu:permission:view`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**请求参数**: 无

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "code": "menu:user:view",
      "name": "查看用户",
      "module": "user",
      "menuCode": "user",
      "action": "view",
      "url": "/users",
      "createdAt": "2025-09-08T09:36:06"
    },
    {
      "id": 2,
      "code": "menu:user:add",
      "name": "新增用户",
      "module": "user",
      "menuCode": "user",
      "action": "add",
      "url": "/users/add",
      "createdAt": "2025-09-08T09:36:06"
    }
  ]
}
```

---

### 2. 创建权限

**接口地址**: `POST /permissions/perm/create`

**权限要求**: `menu:permission:add`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

**请求参数**:
```json
{
  "code": "menu:order:view",
  "name": "查看订单",
  "module": "order",
  "menuCode": "order",
  "action": "view",
  "url": "/orders"
}
```

**参数说明**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| code | String | 是 | 权限标识码，格式：module:menuCode:action |
| name | String | 是 | 权限名称（中文描述） |
| module | String | 是 | 业务模块标识 |
| menuCode | String | 是 | 菜单编码 |
| action | String | 是 | 操作类型 |
| url | String | 否 | 对应的URL路径 |

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "权限创建成功",
  "data": null
}
```

---

### 3. 更新权限

**接口地址**: `PUT /permissions/perm/update`

**权限要求**: `menu:permission:edit`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json
```

**请求参数**:
```json
{
  "id": 1,
  "code": "menu:order:view",
  "name": "查看订单列表",
  "module": "order",
  "menuCode": "order",
  "action": "view",
  "url": "/orders/list"
}
```

**参数说明**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 权限ID |
| code | String | 是 | 权限标识码 |
| name | String | 是 | 权限名称 |
| module | String | 是 | 业务模块标识 |
| menuCode | String | 是 | 菜单编码 |
| action | String | 是 | 操作类型 |
| url | String | 否 | 对应的URL路径 |

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "权限更新成功",
  "data": null
}
```

---

### 4. 删除权限

**接口地址**: `DELETE /permissions/perm/delete/{id}`

**权限要求**: `menu:permission:delete`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**路径参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| id | Long | 是 | 权限ID |

**请求示例**:
```
DELETE /permissions/perm/delete/1
```

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "权限删除成功",
  "data": null
}
```

**注意事项**:
- 删除权限前会自动清理相关的角色权限关联和用户权限关联
- 删除操作会清理权限缓存，确保权限变更立即生效

---

### 5. 获取菜单权限树

**接口地址**: `GET /permissions/perm/menu-tree`

**权限要求**: `menu:permission:view`

**请求头**:
```
Authorization: Bearer {JWT_TOKEN}
```

**请求参数**: 无

**响应示例**:
```json
{
  "success": true,
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "parentId": null,
      "menuCode": "system",
      "name": "系统管理",
      "module": "system",
      "nodeType": 1,
      "sortOrder": 1,
      "createdAt": "2025-09-08T09:36:06",
      "permissions": [],
      "children": [
        {
          "id": 2,
          "parentId": 1,
          "menuCode": "user",
          "name": "用户管理",
          "module": "user",
          "nodeType": 2,
          "sortOrder": 1,
          "createdAt": "2025-09-08T09:36:06",
          "permissions": [
            {
              "id": 1,
              "code": "menu:user:view",
              "name": "查看用户",
              "action": "view",
              "url": "/users",
              "createdAt": "2025-09-08T09:36:06"
            },
            {
              "id": 2,
              "code": "menu:user:add",
              "name": "新增用户",
              "action": "add",
              "url": "/users/add",
              "createdAt": "2025-09-08T09:36:06"
            }
          ],
          "children": []
        }
      ]
    }
  ]
}
```

**响应字段说明**:

*菜单对象结构*:
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 菜单ID |
| parentId | Long | 父级菜单ID |
| menuCode | String | 菜单编码 |
| name | String | 菜单名称 |
| module | String | 业务模块标识 |
| nodeType | Integer | 节点类型：1=文件夹，2=页面，3=按钮 |
| sortOrder | Integer | 排序序号 |
| url | String | URL路径 |
| icon | String | 菜单图标 |
| path | String | 前端组件路径 |
| meta | String | 额外元数据，JSON格式 |
| createdAt | DateTime | 创建时间 |
| permissions | Array | 该菜单下的权限列表 |
| children | Array | 子菜单列表 |

*权限对象结构 (permissions数组中的元素)*:
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Long | 权限ID |
| code | String | 权限编码 |
| name | String | 权限名称 |
| action | String | 操作类型 |
| url | String | URL路径 |
| createdAt | DateTime | 创建时间 |

**使用场景**:
- 角色分配权限时的权限选择界面
- 权限管理界面的树形展示
- 前端菜单权限控制的数据源

**特点**:
- 返回完整的菜单树结构，包含所有层级关系
- 每个菜单节点包含其下的所有权限信息
- 按照sortOrder和id进行排序
- 支持文件夹、页面、按钮三种节点类型

---
